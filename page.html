<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Maze3D</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="Maze3D" style="margin:16px"></canvas>
  <button onclick="draw2dmaze()">2dmap生成</button><button onclick="draw3dmaze()">3dmap生成(未)</button>
  <script>
    // 3d表示参考 https://2dgames.jp/fake-3d-dungeon/
    const getRandomInt = (max) => Math.floor(Math.random() * max);

    const [width,height] = [8,6]
    const mazeSize = { x: width*2+1 , y: height*2+1 };
    const start = { 
      x: 0,
      y: 0
    };
    const goal ={ 
      x: width,
      y: height
    };
    const dirs =[[-2,0],[2,0],[0,-2],[0,2]];

    const canvas = document.getElementById("Maze3D");
    [canvas.width,canvas.height] = [width*40,height*40]
    const ctx = canvas.getContext("2d");
    
    let maze = Array.from({ length: mazeSize.y }, () => Array(mazeSize.x).fill(1));
    const mazeInit = () => {
      maze = Array.from({ length: mazeSize.y }, () => Array(mazeSize.x).fill(1));
      [start.x,start.y] = [getRandomInt(width),getRandomInt(height)];
      do{
        [goal.x,goal.y] = [getRandomInt(width),getRandomInt(height)];
      }while(goal.x == start.x && goal.y == start.y);      
    }
      function shuffle(array){
      for (let i = 0; i < array.length; i++) {
        const r = getRandomInt(i+1);
        [array[i], array[r]] = [array[r], array[i]];
      }
      return array;
    }
    function mazeGenerator(x,y){
      mazeInit();
      dig(x,y);
      randWallBraek(x,y);
    }
    function dig(x,y){
      maze[y][x] = 0;

      const dir = shuffle([...dirs]);
      for (const [dx, dy] of dir) {
        const nx = x + dx;
        const mx = x + dx / 2;
        const ny = y + dy;
        const my = y + dy / 2;

        if (0 < nx && nx < mazeSize.x - 1 && 0 < ny && ny < mazeSize.y - 1 && maze[ny][nx] === 1) {
          maze[my][mx] = 0;
          dig(nx, ny);
        }
      }
    }
    function randWallBraek(){
      const breakNum = Math.floor(width*height/5);
      const wallList = [];
      for (let y = 1; y < mazeSize.y - 1; y++) {
        for (let x = 1; x < mazeSize.x - 1; x++) {
          if (maze[y][x] === 1) {
            if (x*y % 4 != 0) {
              wallList.push({ x, y });
            }
          }
        }
      }
      shuffle(wallList);
      for (let i = 0; i < breakNum && i < wallList.length; i++) {
        const { x, y } = wallList[i];
        maze[y][x] = 0;
      }
    }

    function draw2dmaze(){
      mazeGenerator(2*start.x+1,2*start.y+1);
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const wallWidth = {
        x: canvas.width/(width*10),
        y: canvas.height/(height*10)
      }
      ctx.fillStyle = "black";
      for(let y = 0; y <= height; y++){
        for(let x = 0; x <= width; x++){
          let cx = x*2+1;
          let cy = y*2+1;
          if(cx < 2*width*1 && maze[cy-1][cx]==1){
            ctx.fillRect((x*10-1)*wallWidth.x, (y*10-1)*wallWidth.y, 12*wallWidth.x, 2*wallWidth.y);
          }
          if(cy < 2*height+1 && maze[cy][cx-1]==1){
            ctx.fillRect((x*10-1)*wallWidth.x, (y*10-1)*wallWidth.y, 2*wallWidth.x, 12*wallWidth.y);
          }
        }
      }
      ctx.fillStyle="#82d563";
      ctx.fillRect((start.x*10+2)*wallWidth.x, (start.y*10+2)*wallWidth.y , 6*wallWidth.x, 6*wallWidth.y);
      ctx.fillStyle="red";
      ctx.fillRect((goal.x*10+2)*wallWidth.x, (goal.y*10+2)*wallWidth.y , 6*wallWidth.x, 6*wallWidth.y);
    }
    function draw3dmaze(){
      mazeGenerator(2*start.x+1,2*start.y+1);
      
    }

  </script>
</body>
</html>